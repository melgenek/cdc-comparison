<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Column filters</title>

    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest" type="text/javascript"></script>
</head>
<body>
<a href="javascript:void(0)" onclick="load('merged');">All</a>
<a href="javascript:void(0)" onclick="load('64KB');">64KB</a>
<a href="javascript:void(0)" onclick="load('128KB');">128KB</a>
<a href="javascript:void(0)" onclick="load('256KB');">256KB</a>
<a href="javascript:void(0)" onclick="load('512KB');">512KB</a>
<a href="javascript:void(0)" onclick="load('1MB');">1MB</a>
<a href="javascript:void(0)" onclick="load('2MB');">2MB</a>

<table class="table"></table>

<script>
    let datatable;
    async function load(file) {
        const json = await (await fetch(`../json/${file}.json`)).json();
        let rows = json.results.map(result => {
            return [
                result.name,
                result.chunkSizes,
                result.dedupRatio,
                result.resultChunkCount,
                result.resultChunkSizes,
                result.minChunkSize,
                result.maxChunkSize,
                result.intervalCount,
                result.intervalSizes,
                result.minIntervalSize,
                result.maxIntervalSize,
            ];
        });
        if(datatable) {
            datatable.destroy();
        }
        datatable = new simpleDatatables.DataTable("table", {
            perPageSelect: [20, 50, 100],
            perPage: 20,
            searchable: true,
            searchQuerySeparator: "<>",
            searchAnd: true,
            columns: [
                {
                    select: 2,
                    sort: "desc"
                }
            ],
            data: {
                headings: [
                    "Name",
                    "Chunk Sizes",
                    "Dedup ratio",
                    "Chunk count",
                    "Chunk sizes",
                    "Min chunk size",
                    "Max chunk size",
                    "Interval count",
                    "Interval sizes",
                    "Min interval size",
                    "Max interval size"
                ],
                data: rows
            },
            tableRender: (_data, table, type) => {
                if (type === "print") {
                    return table
                }
                const tHead = table.childNodes[0]
                const filterHeaders = {
                    nodeName: "TR",
                    childNodes: tHead.childNodes[0].childNodes.map(
                        (_th, index) => ({
                            nodeName: "TH",
                            childNodes: [
                                {
                                    nodeName: "INPUT",
                                    attributes: {
                                        class: "datatable-input",
                                        type: "search",
                                        "data-columns": `[${index}]`
                                    }
                                }
                            ]
                        })
                    )
                }
                tHead.childNodes.push(filterHeaders)
                return table
            }
        })
    }

</script>
</body>
</html>
